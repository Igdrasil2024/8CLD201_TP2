trigger:
- main

pool:
  name: Newpool

variables:
  resourceGroupName: '8CLD_201'
  location: 'eastus'
  storageAccountName: '0001storageaccount0001'
  storageContainerName: 'mycontainer'  # Ajoutez le nom du conteneur de stockage

stages:
- stage: Infrastructure
  displayName: Déploiement de l'infrastructure
  jobs:
  - job: DeployInfrastructure
    displayName: Déploiement des ressources Azure
    steps:
    - script: |
        az --version
        pwsh --version
      displayName: 'Vérifier les versions de CLI et Shell'

    - task: AzureCLI@2
      displayName: Déployer le groupe de ressources et le Storage Account
      inputs:
        azureSubscription: '01'  # Vérifiez que la connexion Azure est correcte
        scriptType: pscore  # Utiliser PowerShell Core (pscore) au lieu de bash
        scriptLocation: inlineScript
        inlineScript: |
          echo "Création du groupe de ressources"
          az group create --name $(resourceGroupName) --location $(location)

          echo "Création du Storage Account"
          az storage account create \
            --name $(storageAccountName) \
            --resource-group $(resourceGroupName) \
            --location $(location) \
            --sku Standard_LRS

          echo "Création du container"
          az storage container create \
            --name $(storageContainerName) \
            --account-name $(storageAccountName)